<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–æ–Ω–∞–º–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">

<!-- üîπ –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">–ü–ª–∞–∑–º–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a href="index.html" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li class="nav-item"><a href="array.html" class="nav-link">–ê—Ç–æ–º—ã</a></li>
                <li class="nav-item"><a href="chain.html" class="nav-link active">–ò–æ–Ω—ã</a></li>
                <li class="nav-item"><a class="nav-link active" href="methods.html">–ú–µ—Ç–æ–¥—ã</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- üîπ –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
<div class="container my-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h1 class="h3 mb-4 text-primary">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–æ–Ω–∞–º–∏</h1>

            <!-- üî∏ –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button id="loadIons" class="btn btn-primary">
                    <i class="bi bi-arrow-clockwise"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ –∏–æ–Ω—ã
                </button>
                <span class="text-muted" id="ionCount"></span>
            </div>

            <!-- üî∏ –¢–∞–±–ª–∏—Ü–∞ -->
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-primary">
                    <tr>
                        <th>ID</th>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–ú–∞—Å—Å–∞ (–∫–≥)</th>
                        <th>–ó–∞—Ä—è–¥</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                    </thead>
                    <tbody id="ionTableBody">
                    <tr><td colspan="5" class="text-center text-muted">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- üîπ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–æ–Ω–∞ -->
    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <h2 class="h5 text-success mb-3">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∏–æ–Ω</h2>
            <form id="createIonForm" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–æ–Ω–∞</label>
                    <input type="text" id="ionName" class="form-control" placeholder="Na‚Å∫" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">–ú–∞—Å—Å–∞ (–∫–≥)</label>
                    <input type="number" id="mass" class="form-control" step="any" required>
                </div>
                <div class="col-md-4">
                    <label class="form-label">–ó–∞—Ä—è–¥</label>
                    <input type="number" id="charge" class="form-control" required>
                </div>
                <div class="col-12 text-end">
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- üîπ –£–¥–∞–ª–µ–Ω–∏–µ –∏–æ–Ω–∞ -->
    <div class="card shadow-sm mt-4 mb-5">
        <div class="card-body">
            <h2 class="h5 text-danger mb-3">–£–¥–∞–ª–∏—Ç—å –∏–æ–Ω</h2>
            <div class="input-group">
                <input type="number" id="deleteIonId" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∏–æ–Ω–∞">
                <button id="deleteIon" class="btn btn-danger">
                    <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </div>
    </div>
</div>

<!-- üîπ Footer -->
<footer class="bg-primary text-white text-center py-3 mt-auto">
    <p class="mb-0">¬© 2025 –ü–ª–∞–∑–º–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
</footer>

<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

<script>
    const API_BASE = "/ions";

    document.addEventListener("DOMContentLoaded", () => {
        const tableBody = document.getElementById("ionTableBody");
        const ionCount = document.getElementById("ionCount");
        const loadBtn = document.getElementById("loadIons");
        const createForm = document.getElementById("createIonForm");
        const deleteBtn = document.getElementById("deleteIon");
        const searchBtn = document.getElementById("searchIon");
        const searchResult = document.getElementById("searchResult");

        // üî∏ –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç–∞–±–ª–∏—Ü—ã
        function renderTable(ions) {
            if (!ions || ions.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="5" class="text-center text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>`;
                ionCount.textContent = "";
                return;
            }

            ionCount.textContent = `–í—Å–µ–≥–æ: ${ions.length}`;
            tableBody.innerHTML = ions.map(ion => `
                <tr>
                    <td>${ion.id}</td>
                    <td>${ion.name || "‚Äî"}</td>
                    <td>${ion.mass || "‚Äî"}</td>
                    <td>${ion.charge || "‚Äî"}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${ion.id}">
                            <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </td>
                </tr>
            `).join("");

            document.querySelectorAll(".delete-btn").forEach(btn => {
                btn.addEventListener("click", async () => {
                    const id = btn.dataset.id;
                    if (confirm(`–£–¥–∞–ª–∏—Ç—å –∏–æ–Ω —Å ID ${id}?`)) {
                        const res = await fetch(`${API_BASE}/${id}`, { method: "DELETE" });
                        const json = await res.json();
                        if (res.ok) {
                            alert("‚úÖ " + json.message);
                            loadBtn.click();
                        } else {
                            alert("‚ùå –û—à–∏–±–∫–∞: " + (json.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∏–æ–Ω"));
                        }
                    }
                });
            });
        }

        // üîπ –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–æ–Ω–æ–≤
        loadBtn.addEventListener("click", async () => {
            const response = await fetch(API_BASE);
            const data = await response.json();
            if (response.ok && data.data) renderTable(data.data);
            else tableBody.innerHTML = `<tr><td colspan="5" class="text-center text-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>`;
        });

        // üîπ –°–æ–∑–¥–∞–Ω–∏–µ –∏–æ–Ω–∞
        createForm.addEventListener("submit", async e => {
            e.preventDefault();
            const ion = {
                name: document.getElementById("ionName").value,
                mass: parseFloat(document.getElementById("mass").value),
                charge: parseInt(document.getElementById("charge").value)
            };
            const response = await fetch(API_BASE, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(ion)
            });
            const data = await response.json();
            if (response.ok) {
                alert("‚úÖ " + data.message);
                createForm.reset();
                loadBtn.click();
            } else {
                alert("‚ùå –û—à–∏–±–∫–∞: " + (data.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–æ–Ω"));
            }
        });

        // üîπ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ ID
        deleteBtn.addEventListener("click", async () => {
            const id = document.getElementById("deleteIonId").value.trim();
            if (!id) return alert("–í–≤–µ–¥–∏—Ç–µ ID –∏–æ–Ω–∞");
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∏–æ–Ω —Å ID ${id}?`)) return;
            const response = await fetch(`${API_BASE}/${id}`, { method: "DELETE" });
            const data = await response.json();
            if (response.ok) {
                alert("‚úÖ " + data.message);
                document.getElementById("deleteIonId").value = "";
                loadBtn.click();
            } else {
                alert("‚ùå –û—à–∏–±–∫–∞: " + (data.message || "–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∏–æ–Ω"));
            }
        });


        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadBtn.click();
    });
</script>
</body>
</html>
